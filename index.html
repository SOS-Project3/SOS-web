<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SOS BBQ Monitor</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f8f9fa; color: #333; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
    .container { background: white; padding: 30px 40px; border-radius: 8px; box-shadow: 0 0 15px rgba(0,0,0,0.1); width: 100%; max-width: 500px; }
    h1 { text-align: center; margin-bottom: 20px; }
    h2 { margin-top: 20px; font-size: 18px; }
    label { display: block; margin-top: 10px; font-weight: bold; }
    input, select, button { width: 100%; padding: 8px; margin-top: 5px; font-size: 16px; }
    button { background-color: #007bff; color: white; border: none; cursor: pointer; margin-top: 15px; }
    button:hover { background-color: #0056b3; }
    .hidden { display: none; }
    .live-section p { margin: 5px 0; }
  </style>
</head>
<body>
  <div class="container">
    <h1>SOS BBQ Monitor</h1>

    <!-- WiFi Section -->
    <div class="wifi-section">
      <h2>Connection</h2>
      <label for="wifiName">WiFi Name (SSID):</label>
      <input type="text" id="wifiName" placeholder="Enter WiFi name">

      <label for="wifiPassword">Password:</label>
      <input type="password" id="wifiPassword" placeholder="Enter WiFi password">

      <button id="wifiBtn">Submit WiFi</button>
      <p id="wifiConfirmation" class="hidden">✅ WiFi data sent!</p>
    </div>

    <!-- Live Data Section -->
    <div class="live-section">
      <h2>Live Data</h2>
      <p><strong>Temperature:</strong> <span id="liveTemperature">--</span></p>
      <p><strong>Status:</strong> <span id="liveStatus">--</span></p>
      <p><strong>ESP Connection:</strong> <span id="espConnection">--</span></p>
    </div>

    <!-- Meat/Doneness Section -->
    <div class="control-section">
      <h2>Set Preferences</h2>
      <label for="meatSelect">Meat Type:</label>
      <select id="meatSelect">
        <option value="" disabled selected>Select meat</option>
        <option value="Chicken">Chicken</option>
        <option value="Tri tip">Tri tip</option>
        <option value="Knuckle">Knuckle</option>
        <option value="Flap">Flap</option>
        <option value="Top round">Top round</option>
        <option value="Top sirloin">Top sirloin</option>
        <option value="Flank">Flank</option>
        <option value="Sirloin cap">Sirloin cap</option>
        <option value="Chuck / teres major">Chuck / teres major</option>
        <option value="Steak cut / strip loin">Steak cut / strip loin</option>
        <option value="Rib / ribeye">Rib / ribeye</option>
        <option value="Flat iron">Flat iron</option>
      </select>

      <label for="donenessSelect">Doneness:</label>
      <select id="donenessSelect">
        <option value="" disabled selected>Select doneness</option>
        <option value="Rare">Rare</option>
        <option value="Medium Rare">Medium Rare</option>
        <option value="Medium">Medium</option>
        <option value="Medium Well">Medium Well</option>
        <option value="Well Done">Well Done</option>
      </select>
      <p id="donenessNote" class="hidden" style="color: #555; font-size: 0.9em; margin-top: 5px;">
        Chicken is always cooked Well Done.
      </p>

      <button id="sendBtn">Submit Meat</button>
      <p id="confirmation" class="hidden">✅ Selection sent!</p>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCXDxynz9AKrexXIUmvza8xnPA2HriiePQ",
      authDomain: "sos-project-23171.firebaseapp.com",
      databaseURL: "https://sos-project-23171-default-rtdb.firebaseio.com",
      projectId: "sos-project-23171",
      storageBucket: "sos-project-23171.firebasestorage.app",
      messagingSenderId: "739080997565",
      appId: "1:739080997565:web:8794ee9ba4f4f27de4c5d4"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Elements
    const meatSelect = document.getElementById("meatSelect");
    const donenessSelect = document.getElementById("donenessSelect");
    const donenessNote = document.getElementById("donenessNote");
    const confirmation = document.getElementById("confirmation");
    const wifiBtn = document.getElementById("wifiBtn");
    const wifiConfirmation = document.getElementById("wifiConfirmation");

    // --- MEAT DONENESS LOGIC ---
    function updateDonenessForMeat() {
      const meat = meatSelect.value;
      if (meat === "Chicken") {
        donenessSelect.value = "Well Done";
        donenessSelect.disabled = true;
        donenessNote.classList.remove("hidden");
      } else {
        donenessSelect.disabled = false;
        donenessNote.classList.add("hidden");
        if (donenessSelect.value === "Well Done") donenessSelect.value = "";
      }
    }
    meatSelect.addEventListener("change", updateDonenessForMeat);
    updateDonenessForMeat();

    // --- Submit Meat/Doneness ---
    document.getElementById("sendBtn").addEventListener("click", () => {
      const meat = meatSelect.value;
      const doneness = donenessSelect.value;
      if (!meat || !doneness) { alert("Please select both meat and doneness."); return; }
      set(ref(db, "SOS/settings/meat"), { type: meat, doneness: doneness })
        .then(() => {
          confirmation.classList.remove("hidden");
          confirmation.textContent = `✅ Sent: ${meat} - ${doneness}`;
          setTimeout(() => confirmation.classList.add("hidden"), 3000);
        })
        .catch(err => alert("Error: " + err.message));
    });

    // --- Submit WiFi ---
    wifiBtn.addEventListener("click", () => {
      const wifiName = document.getElementById("wifiName").value;
      const wifiPassword = document.getElementById("wifiPassword").value;
      if (!wifiName || !wifiPassword) { alert("Enter both WiFi name and password."); return; }
      set(ref(db, "SOS/settings/wifi"), { name: wifiName, password: wifiPassword })
        .then(() => {
          wifiConfirmation.classList.remove("hidden");
          wifiConfirmation.textContent = `✅ WiFi Saved: ${wifiName}`;
          setTimeout(() => wifiConfirmation.classList.add("hidden"), 3000);
        })
        .catch(err => alert("Error: " + err.message));
    });

    // --- LIVE DATA LISTENERS ---
    const tempRef = ref(db, "SOS/liveData/temperature");
    const statusRef = ref(db, "SOS/liveData/status");
    const connRef = ref(db, "SOS/liveData/espConnection");

    onValue(tempRef, snapshot => {
      document.getElementById("liveTemperature").textContent = snapshot.exists() ? snapshot.val() + " °C" : "--";
    });
    onValue(statusRef, snapshot => {
      document.getElementById("liveStatus").textContent = snapshot.exists() ? snapshot.val() : "--";
    });
    onValue(connRef, snapshot => {
      document.getElementById("espConnection").textContent = snapshot.exists() ? snapshot.val() : "Disconnected";
    });
  </script>
</body>
</html>
